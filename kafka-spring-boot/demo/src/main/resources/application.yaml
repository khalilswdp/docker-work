logging:
  level:
    root: INFO
    kafkaspringboot.demo: DEBUG
    org.springframework.kafka: DEBUG
    org.apache.kafka: INFO
    org.apache.kafka.clients.NetworkClient: INFO
    org.apache.kafka.common.security: INFO
    # If you want extremely verbose wire/debug (careful: noisy):
    # org.apache.kafka.clients: DEBUG
    # org.apache.kafka.common.network: DEBUG


event:
  bcef:
    kafka:
      # ============================================================
      # Core connection
      # ============================================================
      bootstrap-servers: ${BCEF_KAFKA_BOOTSTRAP:localhost:29092}
      client-id: ${BCEF_KAFKA_CLIENT_ID:bcef-producer}

      # Optional: influence partition selection & cross-AZ routing
      client-rack: ${BCEF_KAFKA_CLIENT_RACK:} # e.g. "paris-a"
      # org.apache.kafka.clients: DEBUG
      # org.apache.kafka.common.network: DEBUG
      # ============================================================
      # Security
      # ============================================================
      security:
        # PLAINTEXT | SASL_PLAINTEXT | SSL | SASL_SSL
        protocol: ${BCEF_KAFKA_SECURITY_PROTOCOL:SASL_PLAINTEXT}

        # SASL (SCRAM)
        sasl:
          mechanism: ${BCEF_KAFKA_SASL_MECHANISM:SCRAM-SHA-512}
          jaas-config: ${BCEF_KAFKA_JAAS:org.apache.kafka.common.security.scram.ScramLoginModule required username="kafka_app" password="kafka_app_password";}

          # Optional advanced knobs (usually empty)
          client-callback-handler-class: ${BCEF_KAFKA_SASL_CLIENT_CALLBACK_HANDLER_CLASS:}
          login-callback-handler-class: ${BCEF_KAFKA_SASL_LOGIN_CALLBACK_HANDLER_CLASS:}
          login-class: ${BCEF_KAFKA_SASL_LOGIN_CLASS:}
          login-refresh-window-factor: ${BCEF_KAFKA_SASL_LOGIN_REFRESH_WINDOW_FACTOR:0.8}
          login-refresh-window-jitter: ${BCEF_KAFKA_SASL_LOGIN_REFRESH_WINDOW_JITTER:0.05}
          login-refresh-min-period-seconds: ${BCEF_KAFKA_SASL_LOGIN_REFRESH_MIN_PERIOD_SECONDS:60}
          login-refresh-buffer-seconds: ${BCEF_KAFKA_SASL_LOGIN_REFRESH_BUFFER_SECONDS:300}

        # TLS/SSL (kept here so you can switch to SASL_SSL later without refactoring)
        ssl:
          enabled: ${BCEF_KAFKA_SSL_ENABLED:false}
          endpoint-identification-algorithm: ${BCEF_KAFKA_SSL_ENDPOINT_ID_ALGO:https} # https|"" (disable host verification)
          truststore-location: ${BCEF_KAFKA_SSL_TRUSTSTORE_LOCATION:}
          truststore-password: ${BCEF_KAFKA_SSL_TRUSTSTORE_PASSWORD:}
          truststore-type: ${BCEF_KAFKA_SSL_TRUSTSTORE_TYPE:PKCS12}
          keystore-location: ${BCEF_KAFKA_SSL_KEYSTORE_LOCATION:}
          keystore-password: ${BCEF_KAFKA_SSL_KEYSTORE_PASSWORD:}
          keystore-type: ${BCEF_KAFKA_SSL_KEYSTORE_TYPE:PKCS12}
          key-password: ${BCEF_KAFKA_SSL_KEY_PASSWORD:}
          protocol: ${BCEF_KAFKA_SSL_PROTOCOL:TLSv1.3}
          enabled-protocols: ${BCEF_KAFKA_SSL_ENABLED_PROTOCOLS:TLSv1.3,TLSv1.2}

      # ============================================================
      # Network / metadata / recovery behavior
      # ============================================================
      network:
        # How bootstrap DNS is treated
        client-dns-lookup: ${BCEF_KAFKA_CLIENT_DNS_LOOKUP:use_all_dns_ips}

        # Idle / request timeouts
        connections-max-idle-ms: ${BCEF_KAFKA_CONNECTIONS_MAX_IDLE_MS:540000}
        request-timeout-ms: ${BCEF_KAFKA_REQUEST_TIMEOUT_MS:30000}
        default-api-timeout-ms: ${BCEF_KAFKA_DEFAULT_API_TIMEOUT_MS:60000}

        # Connection establishment
        socket-connection-setup-timeout-ms: ${BCEF_KAFKA_SOCKET_SETUP_TIMEOUT_MS:10000}
        socket-connection-setup-timeout-max-ms: ${BCEF_KAFKA_SOCKET_SETUP_TIMEOUT_MAX_MS:30000}

        # Reconnect backoff
        reconnect-backoff-ms: ${BCEF_KAFKA_RECONNECT_BACKOFF_MS:50}
        reconnect-backoff-max-ms: ${BCEF_KAFKA_RECONNECT_BACKOFF_MAX_MS:1000}

        # Retry backoff for client-level errors
        retry-backoff-ms: ${BCEF_KAFKA_RETRY_BACKOFF_MS:100}
        retry-backoff-max-ms: ${BCEF_KAFKA_RETRY_BACKOFF_MAX_MS:1000}

        # Metadata refresh
        metadata-max-age-ms: ${BCEF_KAFKA_METADATA_MAX_AGE_MS:300000}

      # ============================================================
      # Producer (feature-rich)
      # ============================================================
      producer:
        # Serializers (String by default; your app can switch to JSON/Avro/etc.)
        key-serializer: ${BCEF_KAFKA_KEY_SERIALIZER:org.apache.kafka.common.serialization.StringSerializer}
        value-serializer: ${BCEF_KAFKA_VALUE_SERIALIZER:org.apache.kafka.common.serialization.StringSerializer}

        # ---- Reliability / delivery semantics
        acks: ${BCEF_KAFKA_PRODUCER_ACKS:all}
        enable-idempotence: ${BCEF_KAFKA_PRODUCER_IDEMPOTENCE:true}

        # MUST be <= 5 when idempotence=true (Kafka rule)
        max-in-flight-requests-per-connection: ${BCEF_KAFKA_PRODUCER_MAX_IN_FLIGHT:5}

        # Retry strategy
        retries: ${BCEF_KAFKA_PRODUCER_RETRIES:2147483647}
        delivery-timeout-ms: ${BCEF_KAFKA_PRODUCER_DELIVERY_TIMEOUT_MS:120000}
        request-timeout-ms: ${BCEF_KAFKA_PRODUCER_REQUEST_TIMEOUT_MS:30000}
        retry-backoff-ms: ${BCEF_KAFKA_PRODUCER_RETRY_BACKOFF_MS:100}

        # ---- Throughput / batching
        linger-ms: ${BCEF_KAFKA_PRODUCER_LINGER_MS:5}
        batch-size: ${BCEF_KAFKA_PRODUCER_BATCH_SIZE:16384} # bytes
        buffer-memory: ${BCEF_KAFKA_PRODUCER_BUFFER_MEMORY:33554432} # 32MB
        compression-type: ${BCEF_KAFKA_PRODUCER_COMPRESSION:snappy} # none|gzip|snappy|lz4|zstd

        # ---- Backpressure / blocking
        max-block-ms: ${BCEF_KAFKA_PRODUCER_MAX_BLOCK_MS:60000}

        # ---- Message sizing
        max-request-size: ${BCEF_KAFKA_PRODUCER_MAX_REQUEST_SIZE:1048576} # 1MB

        # ---- Transactions (optional)
        # Set a prefix to enable transactions. Leave empty to disable.
        transaction-id-prefix: ${BCEF_KAFKA_PRODUCER_TX_ID_PREFIX:}

        # ---- Partitioner / interceptors (optional)
        partitioner-class: ${BCEF_KAFKA_PRODUCER_PARTITIONER_CLASS:}
        interceptor-classes: ${BCEF_KAFKA_PRODUCER_INTERCEPTOR_CLASSES:} # comma-separated class names

        # ---- Metrics / JMX
        metrics:
          enabled: ${BCEF_KAFKA_METRICS_ENABLED:true}
          sample-window-ms: ${BCEF_KAFKA_METRICS_WINDOW_MS:30000}
          num-samples: ${BCEF_KAFKA_METRICS_NUM_SAMPLES:2}
          recording-level: ${BCEF_KAFKA_METRICS_RECORDING_LEVEL:INFO} # INFO|DEBUG
          reporters: ${BCEF_KAFKA_METRICS_REPORTERS:} # class names, comma-separated

      # ============================================================
      # App-level publishing behavior (not Kafka client props)
      # ============================================================
      publishing:
        # Default headers added to every record (your code applies these)
        default-headers:
          x-app: ${BCEF_HEADER_APP:bcef}
          x-env: ${BCEF_HEADER_ENV:local}
          x-version: ${BCEF_HEADER_VERSION:dev}

        # When you publish, how to choose topic by event type, etc.
        routing:
          # eventType -> topic key (see topics.* below)
          map:
            mock-event: topic-1
            audit-event: audit

      # ============================================================
      # Topics (multiple + per-topic optional overrides)
      # IMPORTANT: Kafka producer doesn't create topics; this is for your app tooling
      # ============================================================
      topics:
        topic-1:
          name: ${BCEF_TOPIC_1_NAME:topic_one}
          partitions: ${BCEF_TOPIC_1_PARTITIONS:3}
          replication-factor: ${BCEF_TOPIC_1_RF:1}
          # Optional app-level overrides
          producer-overrides:
            compression-type: ${BCEF_TOPIC_1_COMPRESSION:}  # if set, your app can override producer compression per topic

        topic-2:
          name: ${BCEF_TOPIC_2_NAME:topic_two}
          partitions: ${BCEF_TOPIC_2_PARTITIONS:3}
          replication-factor: ${BCEF_TOPIC_2_RF:1}

        audit:
          name: ${BCEF_TOPIC_AUDIT_NAME:topic_audit}
          partitions: ${BCEF_TOPIC_AUDIT_PARTITIONS:1}
          replication-factor: ${BCEF_TOPIC_AUDIT_RF:1}

      # ============================================================
      # Mock producer job (for demo/testing)
      # ============================================================
      mock:
        enabled: ${BCEF_MOCK_ENABLED:true}
        interval-ms: ${BCEF_MOCK_INTERVAL_MS:1000}
        payload-size-bytes: ${BCEF_MOCK_PAYLOAD_SIZE_BYTES:0} # 0 = normal JSON, else pad payload
